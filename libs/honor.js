!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.honor=t():e.honor=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=["SceneManager","DialogManager","LoadManager","AlertManager"],i={Scene:null,Dialog:null},a={};t.DirectorView={init:function(){for(var e=0,t=o;e<t.length;e++){var n=t[e],r=new Laya.Sprite;r.name="_$"+n,this[r.name]=r,console.log(n),Laya.stage.addChild(r)}},onResize:function(e,t){for(var n=0,r=o;n<r.length;n++){this["_$"+r[n]].size(e,t)}for(var a in i)if(i.hasOwnProperty(a)){var s=i[a];s&&(s.size(e,t),s.onResize&&s.onResize(e,t))}},_createLoadViewByClass:function(e,t,n){var r=Laya.stage,o=r.width,a=r.height;n.size(o,a),n.onReset&&n.onReset(),this.addView("Load",n),i[e]=n,t&&t.run()},_createLoadViewByData:function(e,t,n,r){var o=this;if(!r)throw new Error('Can not find "Scene":'+t);if(!r.props)throw new Error('"Scene" data is error:'+t);var i=r.props.runtime?r.props.runtime:r.type,a=Laya.ClassUtils.getClass(i);this.createView(r,a,t).then(function(t){o._createLoadViewByClass(e,n,t)})},recoverView:function(e){var t=e.url||e.constructor.name;a[t]||(a[t]=[]),a[t].push(e)},getViewByPool:function(e){return a[e]?a[e].pop():null},createView:function(e,t,n,r){return new Promise(function(o,i){var a=new t;if(r&&a.onMounted&&a.onMounted.apply(a,r),"instance"===e.props.renderType&&(a=t.instance||(t.instance=a)),a&&(a instanceof Laya.Scene||a instanceof Laya.Dialog))return a.url=n,void(a._getBit(8)?(a.on("onViewCreated",null,function(){o(a)}),a.createView(e)):o(a));throw new Error("Can not find Scene:"+n)})},setLoadView:function(e,t,n){var o=this;r.LoaderManager.loadScene(null,t,function(r){o._createLoadViewByData(e,t,n,r)})},setLoadViewVisible:function(e,t){var n=i[e];n&&!n.destroyed&&(n.visible=t,t?n.onShow&&n.onShow():n.onReset&&n.onReset())},setLoadProgress:function(e,t){var n=i[e];n&&n.onProgress&&n.onProgress(t)},getView:function(e){return this["_$"+e+"Manager"]},setViewVisible:function(e,t){this["_$"+e+"Manager"].visible=t},addView:function(e,t){this["_$"+e+"Manager"].addChild(t)},addViewAt:function(e,t,n){this["_$"+e+"Manager"].addChildAt(t,n)}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=n(7),s={is_loading:!1};t.LoaderManager={__init__:function(){},loadScene:function(e,t,n){var r=Laya.Loader.getRes(t);if(r)return n(r);this.toggleLoading(e,!0),Laya.loader.resetProgress();var o=new Laya.SceneLoader;o.on(Laya.Event.PROGRESS,this,this.onLoadProgress,[e]),o.once(Laya.Event.COMPLETE,this,this.onLoadComplete,[e,t,o,n]),o.load(t)},load:function(e,t){var n=this;return new Promise(function(c,l){return r(n,void 0,void 0,function(){var n;return o(this,function(r){switch(r.label){case 0:return this.toggleLoading(t,!0),t&&(n=function(e){i.DirectorView.setLoadProgress(t,e)}),s.is_loading=!0,[4,a.loadRes(e,n)];case 1:return r.sent(),this.toggleLoading(t,!1),s.is_loading=!1,[2,c()]}})})})},onLoadProgress:function(e,t){e&&i.DirectorView.setLoadProgress(e,t)},onLoadComplete:function(e,t,n,r){n.off(Laya.Event.PROGRESS,null,this.onLoadProgress),r(Laya.Loader.getRes(t)),e&&this.toggleLoading(e,!1)},toggleLoading:function(e,t){if(e){var n=0;!1===t&&(n=500),clearTimeout(this[e+"_timeout"]),this[e+"_timeout"]=setTimeout(function(){i.DirectorView.setLoadViewVisible(e,t)},n)}}},t.default=t.LoaderManager},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=n(1);t.SceneManager={sceneChangeBeforeListener:[],sceneChangeAfterListener:[],sceneClassMap:{},_curScene:null,__init__:function(){},onResize:function(e,t){this._curScene&&(this._curScene.size(e,t),this._curScene.onResize&&this._curScene.onResize(e,t))},switchScene:function(e,t){var n=Laya.stage,r=n.width,o=n.height;t.size(r,o),t.onMounted&&t.onMounted.apply(t,e),i.DirectorView.addView("Scene",t);var a=this._curScene,s=a?a.url:null;return a&&(a.onClosed&&a.onClosed(),a.destroy()),this._curScene=t,{cur:t.url,prev:s}},callChangeListener:function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];"before"===e?t=this.sceneChangeBeforeListener:"after"===e&&(t=this.sceneChangeAfterListener);for(var o=0,i=t;o<i.length;o++){var a=i[o].apply(void 0,n);if(a)return a}},runScene:function(e){for(var t=this,n=[],s=1;s<arguments.length;s++)n[s-1]=arguments[s];return new Promise(function(s,c){return r(t,void 0,void 0,function(){var t,r,l,u=this;return o(this,function(o){switch(o.label){case 0:return this.callChangeListener("before",this._curScene&&this._curScene.url,e)?[2,c()]:(t=i.DirectorView.getViewByPool(e))?(r=this.switchScene(n,t),[3,6]):[3,1];case 1:return"string"!=typeof e?[3,4]:[4,new Promise(function(t,n){a.LoaderManager.loadScene("Scene",e,function(e){t(e)})})];case 2:return l=o.sent(),[4,this.runSceneByCtor(e,l)];case 3:return t=o.sent(),r=this.switchScene(n,t),[3,6];case 4:return"function"!=typeof e?[3,6]:(t=new e,[4,new Promise(function(e,n){t.once("onViewCreated",u,function(){return e()})})]);case 5:o.sent(),r=this.switchScene(n,t),o.label=6;case 6:return this.callChangeListener("after",r.cur,r.prev),[2,s(t)]}})})})},runSceneByCtor:function(e,t){var n=this;return new Promise(function(r,o){if(!t)throw new Error('Can not find "Scene":'+e);if(!t.props)throw new Error('"Scene" data is error:'+e);var a=t.props.runtime?t.props.runtime:t.type,s=Laya.ClassUtils.getClass(a);n.sceneClassMap[e]=s,i.DirectorView.createView(t,s,e).then(function(e){r(e)})})}},t.default=t.SceneManager},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(0),i=n(5);t.Director={init:function(){Laya.stage.on(Laya.Event.RESIZE,this,this.onResize),this.onResize()},onResize:function(){var e=Laya.stage,t=e.width,n=e.height;o.DirectorView.onResize(t,n),r.SceneManager.onResize(t,n),i.DialogManager.onResize(t,n)},runScene:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return r.SceneManager.runScene.apply(r.SceneManager,[e].concat(t)).catch(function(e){console.error("runScene interrupt")})},get runningScene(){return r.SceneManager._curScene},openDialog:function(e,t,n,r){return void 0===r&&(r=!1),i.DialogManager.openDialog(e,t,n,r)},getDialogByName:function(e){return i.DialogManager.getDialogByName(e)},getDialogsByGroup:function(e){return i.DialogManager.getDialogsByGroup(e)},closeDialogByName:function(e){i.DialogManager.closeDialogByName(e)},closeDialogsByGroup:function(e){i.DialogManager.closeDialogsByGroup(e)},closeAllDialogs:function(){i.DialogManager.closeAll()},setLoadPageForScene:function(e,t){o.DirectorView.setLoadView("Scene",e,t)},setLoadPageForDialog:function(e,t){o.DirectorView.setLoadView("Dialog",e,t)}}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),o=n(0),i=n(2),a=n(1),s=n(3);t.initState=function(){o.DirectorView.init(),i.SceneManager.__init__(),a.LoaderManager.__init__(),t.DialogManager=new r.DialogManager,t.DialogManager.init(),s.Director.init()}},function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var o=n(3);t.director=o.Director;var i=n(1),a=r(n(13));t.sceneChangeMonitor=a;var s=n(5),c=n(0);t.DirectorView=c.DirectorView;t.name="Honor";t.version="0.0.1-beta";var l=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i.LoaderManager.load.apply(i.LoaderManager,e)};t.load=l;var u=!1;function f(e,n){n?Laya.View?(window.Laya3D?Laya3D.init(e.width,e.height):Laya.init(e.width,e.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=e.scaleMode,Laya.stage.screenMode=e.screenMode,Laya.stage.alignV=e.alignV,Laya.stage.alignH=e.alignH,Laya.URL.exportSceneToJson=e.exportSceneToJson,e.debug||"true"==Laya.Utils.getQueryString("debug")?(t.DEBUG_MODE=u=!0,Laya.enableDebugPanel()):t.DEBUG_MODE=u=!1,e.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),Laya.alertGlobalError=!1,Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(null,function(){s.initState(),n()}))):console.error("需要laya.ui库"):console.error("需要引擎启动以后的回调函数，用来启动起始页等")}t.DEBUG_MODE=u,t.run=f,t.Honor={name:"Honor",version:"0.0.1-beta",run:f,director:o.Director,load:l,sceneChangeMonitor:a,DirectorView:c.DirectorView,DEBUG_MODE:u}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.loadRes=function(t,n){var r=this;return new Promise(function(o,i){var a;n&&(a=new Laya.Handler(null,function(e){n(e)},null,!1));var s=new Laya.Handler(r,function(){e(o)});Laya.loader.load(t,s,a)})}}).call(this,n(8).setImmediate)},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,o=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new i(o.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new i(o.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(9),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(4))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,o,i,a,s,c=1,l={},u=!1,f=e.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(e);h=h&&h.setTimeout?h:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick(function(){g(e)})}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((i=new MessageChannel).port1.onmessage=function(e){g(e.data)},r=function(e){i.port2.postMessage(e)}):f&&"onreadystatechange"in f.createElement("script")?(o=f.documentElement,r=function(e){var t=f.createElement("script");t.onreadystatechange=function(){g(e),t.onreadystatechange=null,o.removeChild(t),t=null},o.appendChild(t)}):r=function(e){setTimeout(g,0,e)}:(a="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&g(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),r=function(t){e.postMessage(a+t,"*")}),h.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var o={callback:e,args:t};return l[c]=o,r(c),c++},h.clearImmediate=d}function d(e){delete l[e]}function g(e){if(u)setTimeout(g,0,e);else{var t=l[e];if(t){u=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}(t)}finally{d(e),u=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(4),n(10))},function(e,t){var n,r,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var c,l=[],u=!1,f=-1;function h(){u&&c&&(u=!1,c.length?l=c.concat(l):f=-1,l.length&&d())}function d(){if(!u){var e=s(h);u=!0;for(var t=l.length;t;){for(c=l,l=[];++f<t;)c&&c[f].run();f=-1,t=l.length}c=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function p(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new g(e,t)),1!==l.length||u||s(d)},g.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=p,o.addListener=p,o.once=p,o.off=p,o.removeListener=p,o.removeAllListeners=p,o.emit=p,o.prependListener=p,o.prependOnceListener=p,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(0),l=n(12),u=n(1),f=Laya.Tween,h=Laya.Sprite,d=function(e){e.scale(1,1),e._effectTween=Laya.Tween.from(e,{x:Laya.stage.width/2,y:Laya.stage.height/2,scaleX:0,scaleY:0},300,Laya.Ease.backOut,Laya.Handler.create(this,this.doOpen,[e]),0,!1,!1)},g=function(e){e._effectTween=Laya.Tween.to(e,{x:Laya.stage.width/2,y:Laya.stage.height/2,scaleX:0,scaleY:0},300,Laya.Ease.backIn,Laya.Handler.create(this,this.doClose,[e]),0,!1,!1)},p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.viewContent=null,t.wait_open_dialog_map=new Map,t.dialog_list=[],t}return o(t,e),t.prototype.init=function(){this.maskLayerName="__$DialogManagerMaskLayer:"+Math.random(),this.popupEffectHandler=new Laya.Handler(this,d),this.closeEffectHandler=new Laya.Handler(this,g),this.maskLayer=new h,this.maskLayer.on("click",this,this.closeOnSide),this.maskLayer.name=this.maskLayerName,c.DirectorView.addView("Dialog",this.maskLayer),c.DirectorView.setViewVisible("Dialog",!1),this.viewContent=c.DirectorView.getView("Dialog"),this.viewContent.mouseThrough=!0,Laya.Dialog.manager=this},t.prototype.getDialogConfig=function(e){for(var t=0,n=this.dialog_list;t<n.length;t++){var r=n[t];if(r.dialog===e)return r.config}},t.prototype.closeOnSide=function(){var e=this.viewContent,t=e.getChildAt(e.numChildren-1),n=this.getDialogConfig(t);t instanceof laya.ui.Dialog&&t.name!==this.maskLayerName&&t.isModal&&n.closeOnSide&&t.close()},t.prototype.onResize=function(e,t){var n=this.viewContent;this.maskLayer.size(e,t);for(var r=n.numChildren-1;r>-1;r--){var o=n.getChildAt(r);o.name!==this.maskLayerName&&(o.isPopupCenter&&this.centerDialog(o),o.onResize&&o.onResize(e,t))}this.checkMask()},t.prototype.centerDialog=function(e){e.x=Math.round((Laya.stage.width-e.width>>1)+e.pivotX),e.y=Math.round((Laya.stage.height-e.height>>1)+e.pivotY)},t.prototype.clearDialogEffect=function(e){Laya.timer.clear(e,e.close),e._effectTween&&(f.clear(e._effectTween),e._effectTween=null)},t.prototype.checkMask=function(){var e=this.viewContent;this.maskLayer.removeSelf();for(var t=e.numChildren-1;t>-1;t--){var n=e.getChildAt(t),r=this.getDialogConfig(n);if(n&&n.isModal)return this.maskLayer.graphics.clear(!0),this.maskLayer.graphics.drawRect(0,0,e.width,e.height,r.shadowColor),this.maskLayer.alpha=r.shadowAlpha,void c.DirectorView.addViewAt("Dialog",this.maskLayer,t)}0===e.numChildren&&c.DirectorView.setViewVisible("Dialog",!1)},t.prototype.openDialog=function(e,n,r,o){return void 0===o&&(o=!1),a(this,void 0,void 0,function(){var i,a,l,f,h=this;return s(this,function(s){switch(s.label){case 0:return o?(i=this.wait_open_dialog_map.get(e),a=void 0,i?[4,i.then(function(e){return e})]:[3,2]):[3,4];case 1:return a=s.sent(),[3,3];case 2:(l=this.dialog_list.find(function(t){return t.url===e}))&&(a=l.dialog),s.label=3;case 3:if(a)return a.onMounted.apply(a,n),[2,a];s.label=4;case 4:return f=new Promise(function(o,i){var a=c.DirectorView.getViewByPool("function"==typeof e?e.name:e);if(a)return n&&a.onMounted.apply(a,n),h.openDialogByClass(e,r,a),o(a);"string"!=typeof e?"function"==typeof e&&(a=new e,n&&a.onMounted.apply(a,n),a.once("onViewCreated",t,function(){return h.openDialogByClass(e,r,a),o(a)})):u.LoaderManager.loadScene("Dialog",e,function(t){h.openDialogByData(e,n,r,t).then(function(e){o(e)})})}),this.wait_open_dialog_map.set(e,f.then(function(t){return h.wait_open_dialog_map.delete(e),t})),[4,f];case 5:return[2,s.sent()]}})})},t.prototype.openDialogByData=function(e,t,n,r){var o=this;return new Promise(function(i,a){if(!r)throw new Error('Can not find "Dialog":'+e);if(!r.props)throw new Error('"Dialog" data is error:'+e);var s=r.props.runtime?r.props.runtime:r.type,l=Laya.ClassUtils.getClass(s);c.DirectorView.createView(r,l,e,t).then(function(t){o.openDialogByClass(e,n,t),i(t)})})},t.prototype.openDialogByClass=function(e,t,n){Laya.timer.callLater(this,function(){c.DirectorView.setViewVisible("Dialog",!0)}),this.clearDialogEffect(n);var r=i({},l.DEFAULT_CONFIG,n.config,t);this.dialog_list.push({dialog:n,config:r,url:e}),c.DirectorView.addView("Dialog",n),n.isPopupCenter&&this.centerDialog(n),r.closeOther&&this.closeAll(),n.group&&r.closeByGroup&&this.closeDialogsByGroup(n.group),n.name&&r.closeByName&&this.closeDialogByName(n.name),(n.isModal||this.viewContent._getBit(32))&&Laya.timer.callLater(this,this.checkMask),n.onResize&&(n.scale(1,1),n.onResize()),n.isShowEffect&&null!=n.popupEffect?n.popupEffect.runWith(n):this.doOpen(n)},t.prototype.doOpen=function(e){var t=this.getDialogConfig(e);t.autoClose&&Laya.timer.once(t.autoClose,e,e.close)},t.prototype.close=function(e){this.clearDialogEffect(e),null!=e.closeEffect&&e.closeEffect instanceof Laya.Handler?e.closeEffect.runWith([e]):this.doClose(e)},t.prototype.doClose=function(t){var n=this.dialog_list;if(t.name!==this.maskLayerName){e.prototype.doClose.call(this,t),t.autoDestroyAtClosed||c.DirectorView.recoverView(t);for(var r=0,o=n.entries();r<o.length;r++){var i=o[r],a=i[0];i[1].dialog===t&&n.splice(a,1)}Laya.timer.callLater(this,this.checkMask)}else t.removeSelf()},t.prototype.closeAll=function(){for(var e=this.viewContent,t=e.numChildren-1;t>-1;t--){var n=e.getChildAt(t);this.close(n)}},t.prototype.closeDialogByName=function(e){if(e)for(var t=this.viewContent,n=t.numChildren-1;n>-1;n--){var r=t.getChildAt(n);if(r.name==e){this.close(r);break}}},t.prototype.closeDialogsByGroup=function(e){for(var t=this.viewContent,n=t.numChildren-1;n>-1;n--){var r=t.getChildAt(n);r&&r.group===e&&this.close(r)}},t.prototype.getDialogsByGroup=function(e){for(var t=this.viewContent,n=[],r=t.numChildren-1;r>-1;r--){var o=t.getChildAt(r);o&&o.group===e&&n.push(o)}return n},t.prototype.getDialogByName=function(e){for(var t=this.viewContent,n=t.numChildren-1;n>-1;n--){var r=t.getChildAt(n);if(r&&r.name===e)return r}},t}(Laya.DialogManager);t.DialogManager=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CONFIG={closeOther:!1,closeOnSide:!1,closeByGroup:!1,closeByName:!1,shadowAlpha:.5,shadowColor:"#000000",autoClose:!1,useExit:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);t.onSceneChangeBefore=function(e){r.SceneManager.sceneChangeBeforeListener.push(e)},t.onSceneChangeAfter=function(e){r.SceneManager.sceneChangeAfterListener.push(e)},t.clearListener=function(e){r.SceneManager.sceneChangeBeforeListener=r.SceneManager.sceneChangeBeforeListener.filter(function(t){return t!==e}),r.SceneManager.sceneChangeAfterListener=r.SceneManager.sceneChangeAfterListener.filter(function(t){return t!==e})}}])});